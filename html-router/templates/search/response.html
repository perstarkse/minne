{% if search_result is defined and search_result %}
<ul class="nb-card p-0">
  {% for result in search_result %}
  <li class="p-4 u-hairline hover:bg-base-200/40 flex gap-3">
    <div class="w-10 h-10 flex-shrink-0 self-start mt-1 grid place-items-center border-2 border-neutral bg-base-100 shadow-[4px_4px_0_0_#000]">
      {% if result.url_info and result.url_info.url %}
      <div class="tooltip tooltip-right" data-tip="Web Link">
        {% include "icons/link_icon.html" %}
      </div>
      {% elif result.file_info and result.file_info.file_name %}
      <div class="tooltip tooltip-right" data-tip="File Document">
        {% include "icons/document_icon.html" %}
      </div>
      {% else %}
      <div class="tooltip tooltip-right" data-tip="Text Content">
        {% include "icons/bars_icon.html" %}
      </div>
      {% endif %}
    </div>

    <div class="flex-1 min-w-0">
      <h3 class="text-lg font-extrabold mb-1 leading-snug">
        <a hx-get="/content/{{ result.id }}/read" hx-target="#modal" hx-swap="innerHTML" class="nb-link">
          {% set title_text = result.highlighted_url_title
          | default(result.url_info.title if result.url_info else none, true)
          | default(result.highlighted_file_name, true)
          | default(result.file_info.file_name if result.file_info else none, true)
          | default("Text snippet: " ~ (result.id | string)[-8:], true) %}
          {{ title_text | safe }}
        </a>
      </h3>

      <div class="markdown-content prose-tufte-compact text-base-content/80 mb-3 overflow-hidden line-clamp-6" data-content="{{result.highlighted_text | escape}}">
        {% if result.highlighted_text %}
        {{ result.highlighted_text | escape }}
        {% elif result.text %}
        {{ result.text | escape }}
        {% else %}
        <span class="italic opacity-60">No text preview available.</span>
        {% endif %}
      </div>

      <div class="text-xs flex flex-wrap gap-x-4 gap-y-2 items-center">
        <span class="inline-flex items-center">
          <span class="uppercase tracking-wide opacity-60 mr-2">Category</span>
          <span class="nb-badge">{{ result.highlighted_category | default(result.category, true) | safe }}</span>
        </span>

        {% if result.highlighted_context or result.context %}
        <span class="inline-flex items-center min-w-0">
          <span class="uppercase tracking-wide opacity-60 mr-2">Context</span>
          <span class="nb-badge">{{ result.highlighted_context | default(result.context, true) | safe }}</span>
        </span>
        {% endif %}

        {% if result.url_info and result.url_info.url %}
        <span class="inline-flex items-center min-w-0">
          <span class="uppercase tracking-wide opacity-60 mr-2">Source</span>
          <a href="{{ result.url_info.url }}" target="_blank" class="nb-link truncate" title="{{ result.url_info.url }}">
            {{ result.highlighted_url | default(result.url_info.url ) | safe }}
          </a>
        </span>
        {% endif %}

        <span class="inline-flex items-center">
          <span class="uppercase tracking-wide opacity-60 mr-2">Score</span>
          <span class="nb-badge">{{ result.score }}</span>
        </span>
      </div>
    </div>
  </li>
  {% endfor %}
  </ul>

{% elif query_param is defined and query_param | trim != "" %}
<div class="nb-panel p-5 text-center">
  <p class="text-xl font-extrabold mb-2">No results for “{{ query_param | escape }}”.</p>
  <p class="text-sm opacity-70">Try different keywords or check for typos.</p>
  </div>
{% else %}
<div class="nb-panel p-5 text-center">
  <p class="text-lg font-semibold">Enter a term above to search your knowledge base.</p>
  <p class="text-sm opacity-70">Results will appear here.</p>
  </div>
{% endif %}
